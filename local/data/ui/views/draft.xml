<dashboard>
  <label>Draft</label>
  <row>
    <panel>
      <viz type="viz_halo.halo">
        <search>
          <query>index=fec sourcetype=fec_schedule_e office=S
| stats sum(expenditure_amount) as spent first(committee.name) as committee.name by committee_id candidate_id toward
| lookup candidates.csv candidate_id output name as candidate.name party state
| eventstats sum(spent) as total 
| eventstats sum(spent) as candidate_total by candidate.name 
| eventstats sum(spent) as committee_total by committee.name
| eval candidate_pct=candidate_total/total*100
| eval committee_pct=committee_total/total*100
| where candidate_pct&gt;2
| eval committee.name=if(committee_pct&gt;0.2, 'committee.name', "others")
| eval candidate.name=replace('candidate.name', ", .+$", "")." - ".state
| stats sum(spent) as spent by candidate_id committee.name candidate.name toward party
| rename committee.name as outer candidate.name as inner toward as ribbon spent as count
| eval inner_img="/static/app/fec_schedule_e_2018/".candidate_id.".jpg"
| eval ribbon_color=if(ribbon="supporting", "green", "orange")
| eval inner_color=case(party="REP", "red", party="DEM", "blue", 0=0, "grey")
| table outer inner inner_color inner_img ribbon count ribbon_color
| sort 0 outer</query>
          <earliest>1483257600</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="drilldown">none</option>
        <option name="height">1000</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="viz_halo.halo.auto_transition">never</option>
        <option name="viz_halo.halo.auto_transition_sleep">5000</option>
        <option name="viz_halo.halo.draggable">on</option>
        <option name="viz_halo.halo.label_font_size">13</option>
        <option name="viz_halo.halo.label_relax_delta">2</option>
        <option name="viz_halo.halo.outer_colors">schemeCategory20</option>
        <option name="viz_halo.halo.outer_thickness">15</option>
        <option name="viz_halo.halo.thickness">10</option>
        <option name="viz_halo.halo.width">1500</option>
      </viz>
    </panel>
  </row>
</dashboard>